"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[789],{6270:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var n=o(3438),s=o(5627);const i={sidebar_position:1,sidebar_label:"Block Transitions"},r="Blocks",a={id:"learn/blocks",title:"Blocks",description:"Monomer applications must support both the usual Cosmos SDK application functionality and rollup-specific workflows.",source:"@site/docs/learn/blocks.md",sourceDirName:"learn",slug:"/learn/blocks",permalink:"/learn/blocks",draft:!1,unlisted:!1,editUrl:"https://github.com/polymerdao/monomer/tree/main/docs/docs/learn/blocks.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"Block Transitions"},sidebar:"tutorialSidebar",previous:{title:"Learn",permalink:"/category/learn"},next:{title:"x/rollup",permalink:"/learn/rollup-module"}},c={},l=[{value:"State",id:"state",level:2},{value:"State Transition Function",id:"state-transition-function",level:2},{value:"1. Deposit Tx Pre-Processing",id:"1-deposit-tx-pre-processing",level:3},{value:"2. Appchain Block Production",id:"2-appchain-block-production",level:3},{value:"3. Withdrawal Tx Post-Processing",id:"3-withdrawal-tx-post-processing",level:3}];function d(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"blocks",children:"Blocks"}),"\n",(0,n.jsx)(t.p,{children:"Monomer applications must support both the usual Cosmos SDK application functionality and rollup-specific workflows."}),"\n",(0,n.jsxs)(t.p,{children:["In order to achieve this, Monomer defines custom ",(0,n.jsx)(t.code,{children:"Block"})," and block ",(0,n.jsx)(t.code,{children:"Header"})," types, with helper functions to generate representations that are consistent with both the Cosmos SDK and the EVM."]}),"\n",(0,n.jsx)(t.h2,{id:"state",children:"State"}),"\n",(0,n.jsx)(t.p,{children:"The main application state of a Monomer application is the Cosmos Appchain state."}),"\n",(0,n.jsx)(t.p,{children:"Supplementary state, required for rollup withdrawal operations, is stored in an internal EVM sidecar state. In principle, these requirements could be met in the Cosmos Appchain state, but this would have a knock-on effect of needing to modify some L1 components of the OP Stack. The sidecar approach allows for the reuse of existing components on both L1 and L2."}),"\n",(0,n.jsx)(t.h2,{id:"state-transition-function",children:"State Transition Function"}),"\n",(0,n.jsx)(t.p,{children:"Monomer's block production function can be thought of in three phases. More detail on these processes is in the following sections."}),"\n",(0,n.jsx)(t.h3,{id:"1-deposit-tx-pre-processing",children:"1. Deposit Tx Pre-Processing"}),"\n",(0,n.jsxs)(t.p,{children:["Block production is triggered by API calls from the ",(0,n.jsx)(t.code,{children:"op-node"})," to Monomer. These API calls include transactions, sourced from L1, that must be included as the first transactions of the rollup block."]}),"\n",(0,n.jsx)(t.p,{children:"Because these transactions are sourced from the OP Stack and Ethereum, they must be adapted to the Cosmos SDK transaction format."}),"\n",(0,n.jsx)(t.h3,{id:"2-appchain-block-production",children:"2. Appchain Block Production"}),"\n",(0,n.jsx)(t.p,{children:"After the deposit transactions have been adapted, they are combined with Cosmos SDK transactions from the mempool, and applied against the current state to form a new block."}),"\n",(0,n.jsx)(t.h3,{id:"3-withdrawal-tx-post-processing",children:"3. Withdrawal Tx Post-Processing"}),"\n",(0,n.jsxs)(t.p,{children:["The created block is inspected for withdrawal initiating transactions. Wherever an L2 transaction initiates a withdrawal, the corresponding updates are made to an internal EVM sidecar state via the ",(0,n.jsx)(t.code,{children:"L2ToL1MessagePasser"})," contract.\nThis allows Monomer to provide Ethereum state proofs back to L1 when proving the withdrawal occurred on L2."]})]})}function p(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},5627:(e,t,o)=>{o.d(t,{R:()=>r,x:()=>a});var n=o(3790);const s={},i=n.createContext(s);function r(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);