"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[921],{7739:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var s=o(3438),n=o(5627),i=o(3640);const r={sidebar_position:2},a="Deposits",c={id:"learn/deposits",title:"Deposits",description:"Monomer supports ETH deposits through the OptimismPortal L1 contract. This is the canonical way to move assets from Ethereum to the Monomer rollup chain, and the easiest way to bootstrap liquidity on the rollup chain.",source:"@site/docs/learn/deposits.md",sourceDirName:"learn",slug:"/learn/deposits",permalink:"/learn/deposits",draft:!1,unlisted:!1,editUrl:"https://github.com/polymerdao/monomer/tree/main/docs/docs/learn/deposits.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"x/rollup",permalink:"/learn/rollup-module"},next:{title:"Withdrawals",permalink:"/learn/withdrawals"}},l={},d=[{value:"The OP Stack",id:"the-op-stack",level:2},{value:"The Monomer Adapter",id:"the-monomer-adapter",level:2},{value:"The Cosmos-SDK Appchain",id:"the-cosmos-sdk-appchain",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"deposits",children:"Deposits"}),"\n",(0,s.jsxs)(t.p,{children:["Monomer supports ETH deposits through the ",(0,s.jsx)(t.a,{href:"https://github.com/ethereum-optimism/optimism/blob/d48b45954c381f75a13e61312da68d84e9b41418/packages/contracts-bedrock/src/L1/OptimismPortal.sol",children:(0,s.jsx)(t.code,{children:"OptimismPortal"})})," L1 contract. This is the canonical way to move assets from Ethereum to the Monomer rollup chain, and the easiest way to bootstrap liquidity on the rollup chain."]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsxs)(t.p,{children:["Currently, only ",(0,s.jsx)(t.code,{children:"value"})," deposits are supported. General ",(0,s.jsx)(t.code,{children:"transactions"})," originating from the L1 are a roadmap item."]})}),"\n",(0,s.jsx)(t.p,{children:"The deposit transaction flow is illustrated below. Broadly, the lifecycle moves from OP-Stack components, to the Monomer adapter layer, and finally into to the Cosmos-SDK appchain."}),"\n",(0,s.jsx)(i.A,{alt:"Deposit workflow",sources:{light:"/img/deposits-light.png",dark:"/img/deposits-dark.png"}}),"\n",(0,s.jsx)(t.h2,{id:"the-op-stack",children:"The OP Stack"}),"\n",(0,s.jsx)(t.p,{children:"The first three steps are entirely the domain of the OP-stack infrastructure. Briefly:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"An ethereum user sends a deposit transaction to the L1 Optimism Portal contract. This contract is part of the OP Stack core infrastructure for rollups."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"The OP stack protocol is obligated to include observed L1 transactions in the L2 blocks it produces within a given timeout."}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsxs)(t.li,{children:["The ",(0,s.jsx)(t.code,{children:"op-node"})," listens for these L1 deposits, and"]}),"\n",(0,s.jsxs)(t.li,{children:["passes them to the execution layer via the ",(0,s.jsx)(t.code,{children:"EngineAPI"})]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Notably, the ",(0,s.jsx)(t.code,{children:"op-node"})," is blind to the fact that it is communicating with Monomer rather than a vanilla EVM execution client (like ",(0,s.jsx)(t.code,{children:"op-geth"}),"). Refer to the ",(0,s.jsx)(t.a,{href:"https://specs.optimism.io/protocol/deposits.html",children:"OP Stack specification"})," for more details on the deposit workflow."]}),"\n",(0,s.jsx)(t.h2,{id:"the-monomer-adapter",children:"The Monomer Adapter"}),"\n",(0,s.jsxs)(t.p,{children:["In order to communicate with the ",(0,s.jsx)(t.code,{children:"op-node"}),", Monomer implements the execution layer endpoints for the ",(0,s.jsx)(t.a,{href:"https://hackmd.io/@danielrachi/engine_api",children:"EngineAPI"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"Because the OP stack and the EngineAPI are Ethereum specific, Monomer's chief responsibility is to translate the Ethereum encoded deposit transactions into a format that the Cosmos-SDK appchain can understand."}),"\n",(0,s.jsxs)(t.ol,{start:"4",children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"AdaptPayloadTXsToCosmosTxs(...)"})," is called on each received EngineAPI call with transaction payloads."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["In the ",(0,s.jsx)(t.code,{children:"x/rollup"})," module, Monomer defines a custom Cosmos-SDK message type to carry deposit transaction data."]}),"\n",(0,s.jsxs)(t.p,{children:["For each rollup block, all deposit transactions sourced from the L1 are batched into a single ",(0,s.jsx)(t.code,{children:"DepositTxs"})," transaction. The engine now awaits the ",(0,s.jsx)(t.code,{children:"op-node"}),"'s request to finalize a block. When that request comes:"]}),"\n",(0,s.jsxs)(t.ol,{start:"5",children:["\n",(0,s.jsxs)(t.li,{children:["the cached transaction is passed to Monomer's ",(0,s.jsx)(t.code,{children:"builder.Build()"}),", which encapsulates the Cosmos-SDK appchain. In accordance with the OP stack spec, the ",(0,s.jsx)(t.code,{children:"DepositTxs"})," transaction is the first transaction in each L2 block."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"the-cosmos-sdk-appchain",children:"The Cosmos-SDK Appchain"}),"\n",(0,s.jsxs)(t.p,{children:["The Cosmos Appchain now builds a block as usual. Monomer's contribution here is the ",(0,s.jsx)(t.code,{children:"x/rollup"})," module, which:"]}),"\n",(0,s.jsxs)(t.ol,{start:"6",children:["\n",(0,s.jsx)(t.li,{children:"unpacks the deposit transaction, minting ETH according to embedded values"}),"\n",(0,s.jsx)(t.li,{children:"emits events for each deposit"}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},5627:(e,t,o)=>{o.d(t,{R:()=>r,x:()=>a});var s=o(3790);const n={},i=s.createContext(n);function r(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);