"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[75],{2502:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>h});var a=i(3438),n=i(5627),o=i(3640);const r={sidebar_position:3},s="Withdrawals",l={id:"learn/withdrawals",title:"Withdrawals",description:"Monomer supports ETH withdrawals through the Optimism Portal L1 contract. This is the canonical way to move assets from an OP Stack rollup chain to Ethereum.",source:"@site/docs/learn/withdrawals.md",sourceDirName:"learn",slug:"/learn/withdrawals",permalink:"/learn/withdrawals",draft:!1,unlisted:!1,editUrl:"https://github.com/polymerdao/monomer/tree/main/docs/docs/learn/withdrawals.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Deposits",permalink:"/learn/deposits"},next:{title:"L2 Transactions",permalink:"/learn/l2-mempool"}},d={},h=[{value:"Initiating Withdrawals",id:"initiating-withdrawals",level:2},{value:"L2 Appchain",id:"l2-appchain",level:3},{value:"Monomer Block Builder",id:"monomer-block-builder",level:3},{value:"Proving and Finalizing Withdrawals",id:"proving-and-finalizing-withdrawals",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"withdrawals",children:"Withdrawals"}),"\n",(0,a.jsx)(t.p,{children:"Monomer supports ETH withdrawals through the Optimism Portal L1 contract. This is the canonical way to move assets from an OP Stack rollup chain to Ethereum."}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsx)(t.p,{children:"For UX purposes, exiting an ORU via the canonical bridge is impractical and slow. But the exit mechanism must be available for security reasons."})}),"\n",(0,a.jsxs)(t.p,{children:["The withdrawal transaction flow is illustrated below. The lifecycle moves in the opposite direction than the Deposits flow - starting at the Cosmos-SDK appchain, processed by the Monomer ",(0,a.jsx)(t.code,{children:"x/rollup"})," module and then Monomer's builder, and finally into the OP-Stack components on L1."]}),"\n",(0,a.jsxs)(t.p,{children:["Again, this document focuses on Monomer specific modifications. Full documentation for the withdrawal flow is available in the ",(0,a.jsx)(t.a,{href:"https://specs.optimism.io/protocol/withdrawals.html",children:"OP Stack specs"}),"."]}),"\n",(0,a.jsx)(o.A,{alt:"Withdrawal workflow",sources:{light:"/img/withdrawals-light.png",dark:"/img/withdrawals-dark.png"}}),"\n",(0,a.jsx)(t.h2,{id:"initiating-withdrawals",children:"Initiating Withdrawals"}),"\n",(0,a.jsxs)(t.p,{children:["The withdrawal process begins with an L2 user submitting a withdrawal transaction to the Cosmos-SDK appchain, with the same data used to initiate a withdrawal on a standard OP Stack. These messages are interpreted by both the ",(0,a.jsx)(t.code,{children:"x/rollup"})," module of the appchain, and the Monomer block builder, which writes necessary data to the ",(0,a.jsx)(t.a,{href:"/learn/blocks#state",children:"EVM sidecar"}),"."]}),"\n",(0,a.jsx)(t.h3,{id:"l2-appchain",children:"L2 Appchain"}),"\n",(0,a.jsxs)(t.p,{children:["On the L2 appchain, via custom message types and handlers from the ",(0,a.jsx)(t.code,{children:"x/rollup"})," module, a withdrawal transaction results in a simple ETH burn on the L2, along with emission of corresponding ",(0,a.jsx)(t.code,{children:"withdrawal_initiated"})," and ",(0,a.jsx)(t.code,{children:"burn_eth"})," events."]}),"\n",(0,a.jsx)(t.h3,{id:"monomer-block-builder",children:"Monomer Block Builder"}),"\n",(0,a.jsxs)(t.p,{children:["After each L2 appchain block, the Monomer block builder listens for ",(0,a.jsx)(t.code,{children:"withdrawal_initiated"})," events from successful L2 transactions.\nFor each observed event, the builder makes a corresponding ",(0,a.jsx)(t.code,{children:"L2ToL1MessagePasserExecuter"})," contract call into the internal EVM sidecar state to store the withdrawal transaction for use when proving the withdrawal on L1."]}),"\n",(0,a.jsx)(t.h2,{id:"proving-and-finalizing-withdrawals",children:"Proving and Finalizing Withdrawals"}),"\n",(0,a.jsx)(t.p,{children:"The next step for a user is to obtain a proof of the withdrawal transaction."}),"\n",(0,a.jsxs)(t.p,{children:["For compatibility with the withdrawals process, Monomer uses the state root of its EVM sidecar state as the L2 state updated by the ",(0,a.jsx)(t.code,{children:"op-proposer"}),". Monomer exposes the standard ethereum ",(0,a.jsx)(t.code,{children:"GetProof"})," API endpoint for obtaining a merkle proof of withdrawal transactions registered in the EVM sidecar state."]}),"\n",(0,a.jsx)(t.p,{children:"With the withdrawal proof data, the user is now back to the L1 side of the OP Stack. The proof is submitted, and the withdrawal can be finalized after the rollup's challenge period."})]})}function p(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},5627:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>s});var a=i(3790);const n={},o=a.createContext(n);function r(e){const t=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),a.createElement(o.Provider,{value:t},e.children)}}}]);